<aside>
💡

로그인 처리 STEP02: "./3.2 로그인 STEP01.md" 정상 수행 이후 wpayUserKey를 전달 받아 WPAY PIN Auth를 수행 한다.

- WPAY 서비스 연동 참고
  - "./WPAY 서비스 연동 가이드/WPAY 연동 가이드.md"

</aside>

## 목표

- WPAY PIN Auth를 통해 로그인을 진행하는 사용자의 본인 여부를 확인 한다.
- WPAY PIN Auth가 성공하면 로그인이 완료된 상태이며 메인페이지로 이동 한다.
- WPAY PIN Auth가 실패하면 로그인을 중단한다.

## WPAY PIN Auth 진행 조건

- "./3.2 로그인 STEP01.md" 의 성공 조건을 만족해야 한다.
- "./3.2 로그인 STEP01.md"로 부터 wpayUserKey를 전달 받아야 한다.

## WPAY PIN Auth Web Page Open

- WPAY 서비스 연동 가이드 선택
  - 로그인 페이지 "label: Service" 선택 값으로 WPAY 연동 가이드를 사용 한다.
  - WPAYSTD: "./WPAY 서비스 연동 가이드/WPAYSTD/2. WPAY PIN Auth.md"
  - WPAYSTD2: "./WPAY 서비스 연동 가이드/WPAYSTD2/2. WPAY PIN Auth.md"
  - WPAYCST: "./WPAY 서비스 연동 가이드/WPAYCST/2. WPAY PIN Auth.md"
  - WPAYPRO: "./WPAY 서비스 연동 가이드/WPAYPRO/2. WPAY PIN Auth.md"

- Web Page URL
  - {site name}
    - 로그인 페이지 "label: Site" 선택 값에 따라 {site name}을 설정 한다.
      - src/lib/types/wpayServerType.ts의 SITE_OPTIONS를 참고 한다.
  - Domain
    - 로그인 페이지 "label: Server" 선택 값에 따라 Domain을 설정 한다.
      - src/lib/types/wpayServerType.ts의 PROD_SERVER_DOMAINS를 참고 한다.

- Request Data의 returnUrl
  - {site name}
    - 로그인 페이지 "label: Site" 선택 값에 따라 {site name}을 설정 한다.
      - src/lib/types/wpayServerType.ts의 SITE_OPTIONS를 참고 한다.

- WPAY PIN Auth 성공.
  - authToken을 생성한다.
    - "./1. 프로젝트 목표.md"에 정의 된 정책대로 authToken을 생성 및 저장 한다.

## WPAY PIN Auth 처리 결과 데이터 View 모달 Open 한다.

- WPAY PIN Auth 처리가 완료되고 팝업이 닫히면 View 모달을 오픈한다.
- WPAY PIN Auth 처리 결과 Response Data를 받는다.
- WPAY로 부터 받은 암호화된 데이터 리스트와 복호화된 데이터 리스트를 테이블 형태로 View 모달에 표시 한다.
  - resultMsg의 경우 URL Decode를 수행한 후 "+" 문자가 포함된 경우 공백으로 변경 한다.
- View 모달 하단에 "확인" 버튼을 표시 한다.
  - "확인" 버튼을 클릭하면 WPAY PIN Auth 성공인 경우 메인화면으로 이동하고, 실패한 경우 모달을 닫는다.
    - 상단의 "X" 버튼 클릭도 동일하게 동작 한다.
