<aside>
💡

서비스 가입 요청 프로세스를 처리한다.

- WPAY 서비스 연동 참고
  - 1. WPAY 연동 가이드.md
  - 2. WPAY 회원 가입 요청.md

</aside>

## 목표

- 서비스 가입은 로그인 페이지에서 진행한다.
- wpay에서 제공하는 회원 가입 웹페이지를 window.open (popup 형태)으로 오픈한다.
- wpay 회원 가입이 완료되면 응답으로 받은 wpayUserKey Token을 localStorage에 저장한다.
- wpayUserKey Token이 localStorage에 저장되면 로그인 페이지를 메인 화면으로 이동한다.

## WPAY 서비스 가입 진행 조건

- Next Button이 활성화 된 상태에서 클릭을 했을 때 다음 조건을 확인 한다.
  - Cell Phone Number가 없으면 wpay 서비스 가입을 수행한다.
  - Cell Phone Number가 있지만 localStorage에 wpayUserKey Token이 저장되지 않은 상태라면 wpay 서비스 가입을 수행한다.

## WPAY 서비스 가입 Web Page Open

- WPAY 서비스 가입 web page URL.
  - {site name}
    - site name은 로그인 페이지에서 선택한 site name을 사용 한다.
  - Domain
    - 로그인 페이지에서 선택한 server type에 따라 domain을 설정 한다.
      - secrets.ts의 PROD_SERVER_DOMAINS를 참고 한다.

- 서비스 가입 Request Data 세팅.

    | Field Name | Set Value |  |
    | --- | --- | --- |
    | mid | 로그인 페이지에서 선택한 Merchant ID |  |
    | userid  | 로그인 페이지에 입력된 Member ID | 입력한 값이 없으면 Member ID input box의 hit 값을 세팅 한다. |
    | hNum  | 로그인 페이지에 입력된 Cell Phone Number | 입력한 값이 없으면 빈 값을 세팅 한다. |
    | returnUrl  | /external/wpay/callback/memreg | HTTP Method : POST |
    | signature | signature 생성 규칙에 맞게 생성 한다. | signature 생성 시 hashKey는 cryptoKeys.ts 의 MERCHANT_KEYS를 참고 한다. |

  - Request Field 암호화
    - Request Field 암호화 및 Encoding 규칙에 맞게 Request Data를 세팅 한다.
    - 암호화 규칙은 cryptoKeys.ts의 MERCHANT_KEYS를 참고 한다.